\begin{figure*}
  \centering

  \textsc{additional syntax}
  \begin{displaymath}
    \begin{array}{rccl}
      \text{expressions} & e,f,g &\bnfeq&
      ... \bnfor \eeqraw[\eqt A]{e}{f}
      \bnfor \bot_L \bnfor e \vee_L f \bnfor \efor[L]{x \in e} f
      \bnfor \efixisraw[\fixt L]{x}{e}\\
      &&& \eiter[\eqt A]{e}{f}{x}{g} %\bnfor \eitercmp[\eqt A]{e}{e}{x}{e}
      \\[\bnfskip]
      \text{values} & v,u &\bnfeq&
      \fnof{x} e \bnfor \etuple{} \bnfor \etuple{v, u} \bnfor \inj i v
      \bnfor \esetraw{{v}_i}_i \bnfor \eboxraw{v}
      \\[\bnfskip]
      \text{evaluation contexts} & E &\bnfeq&
      \emptyhole \bnfor E\<e \bnfor v\<E \bnfor \etuple{E, e}
      \bnfor \etuple{v, E} \bnfor \pi_i\< E\\
      &&& \inj i E \bnfor \emcase{E}{(\inj i x_i \caseto e_i)_i}\\
      &&& \eboxraw{E} \bnfor \eletbox{x}{E}{e}\\
      &&& \esetraw{\vec v,\, E,\, \vec e}
      \bnfor E \vee_L e \bnfor v \vee_L E \bnfor \efor[L]{x \in E} e\\
      &&& \eeqraw[A]{E}{e} \bnfor \eeqraw[A]{v}{E}
      \bnfor \esplit E \bnfor \eisemptyraw E\\
      &&& \eiter[A]{E}{e}{x}{f} \bnfor \eiter[A]{v}{E}{x}{e}
    \end{array}
  \end{displaymath}
  \vspace{0pt}

  \textsc{value (in)equality}
  \begin{mathpar}
    \infer{}{\etuple{} \le \etuple{} : \tunit}

    \infer{v_1 \le u_1 : \eqt A \\ v_2 \le u_2 : \eqt B}{%
      \etuple{v_1,\, v_2} \le \etuple{u_1,\, u_2} : \eqt A \x \eqt B}

    \infer{v \le u : A_i}{\inj i v \le \inj i u : A_1 + A_2}

    \infer{\faex{i}{j} v_i = u_j : \eqt A}{
      \esetraw{v_i}_i \le \esetraw{u_j}_j : \tset{\eqt A}
    }

    \infer{v \le u : \eqt A\\ u \le v : \eqt A}{v = u : \eqt A}
  \end{mathpar}
  \vspace{2pt}

  \textsc{$\beta$ reductions}
  \begin{align*}
    (\fnof{x}e)\<v &~\stepsto~ \subone{e}{x}{v}
    &
    \eletbox{x}{\eboxraw{v}}{e} &~\stepsto~ \subone{e}{x}{v}
    \\
    \pi_i\<\etuple{v_1,\,v_2} &~\stepsto~ v_i
    &
    \emcase{\inj i v}{(\inj j x_j \caseto e_j)_j}
    &~\stepsto~ \subone{e_i}{x_i}{v}
    \\
    \efor[L]{x \in \esetraw{}} e &~\stepsto~ \bot_L
    &
    \efor[L]{x \in \esetraw{v, \vec u}} e
    &~\stepsto~
      (\subone{e}{x}{v}) \vee_L \efor[L]{x \in \esetraw{\vec u}} e
  \end{align*}
  \vspace{0pt}

  \textsc{other reductions}
  \begin{align*}
    \bot_{\tset{A}} &~\stepsto~ \esetraw{}
    &
    \bot_{L \x M} &~\stepsto~ \etuple{\bot_L,\,\bot_M}
    \\
    \esetraw{\vec v} \vee_{\tset A} \esetraw{\vec u}
    &~\stepsto~ \esetraw{\vec v,\, \vec u}
    &
    \etuple{v_1, v_2} \binvee_{L \x M} \etuple{u_1, u_2}
    &~\stepsto~ \etuple{v_1 \vee_L u_1,\, v_2 \vee_M u_2}
    \\
    \eisemptyraw{\esetraw{}} &~\stepsto~ \etrue
    &
    \eisemptyraw{\esetraw{v,\vec u}} &~\stepsto~ \efalse
    \\
    \esplit{\eboxraw{\inj i v}} &~\stepsto~ \inj i {\eboxraw v}
    &
    \eeqraw[\eqt A]{v}{u}
    &~\stepsto~
    \begin{cases}
      \etrue & \text{if}~ v = u : \eqt A\\
      \efalse & \text{otherwise}
    \end{cases}
    \\
    \efixisraw[\fixt L]{x}{e}
    &\omit\rlap{$~\stepsto~
    \eiter[\fixt L]{\bot_{\fixt L}}{\subone{e}{x}{\bot_{\fixt L}}}{x}{e}
    $}
    \\
    \eiter[\eqt A]{v}{u}{x}{e}
    &\omit\rlap{$~\stepsto~
    \begin{cases}
      v & \text{if}~ v = u : \eqt A\\
      \eiter[\eqt A]{u}{\subone{e}{x}{u}}{x}{e} & \text{otherwise}
    \end{cases}$}
  \end{align*}

  \splittodo{should boxes not be values?}{%
    changes: values, eval ctx, reductions(letbox, split)}\\
  \todo{finished?}

  \caption{Operational semantics}
  \label{figure-operational-semantics}
\end{figure*}

  %% %% OPSEM: Rules for (v \le u : A)
  %% \begin{minipage}{0.45\textwidth}
  %%   \centering
  %%   \textbf{Rules for $v \le u : \eq{A}$ and $v \aeq u : \eq{A}$}
  %%   \begin{mathpar}
  %%     \infer{\ms{false} \le \ms{false} : \bool}{}
  %%     \and
  %%     \infer{\ms{false} \le \ms{true} : \bool}{}
  %%     \and
  %%     \infer{\ms{true} \le \ms{true} : \bool}{}
  %%     \and
  %%     %% rules for set inequality
  %%     \infer[\rn{\subseteq}]
  %%           { \setlit{\vec{v_i}} \le \setlit{\vec{u_i}} : \Set{\eq{A}} }
  %%           { \forall{v_i}\,\exists{u_j}\; (v_i \aeq u_j : \eq{A}) }
  %%           \and
  %%           \infer%% [\rn{\le_{\x}}]
  %%               { (v_1, u_1) \le (v_2, u_2) : \eq{A} \x \eq{B} }
  %%               { v_1 \le v_2 : \eq{A} & u_1 \le u_2 : \eq{B} }
  %%               \and
  %%               \infer%% [\rn{\le_{+}}]
  %%                   { \inj i v \le \inj i u : \eq{A}_1 + \eq{A}_2 }
  %%                   { v \le u : \eq{A}_i }
  %%                   \and
  %%                   \infer[\rn{{\aeq}}]{v \aeq u : \eq{A}}{v \le u : \eq{A} & u \le v : \eq{A}}
  %%   \end{mathpar}
  %% \end{minipage}
  %% %% OPSEM: Rules for \step
  %% \vspace{1em}
  %% \begin{displaymath}
  %%   \begin{array}{ccl}
  %%     \multicolumn{3}{c}{\textbf{$\beta$-reductions}}\\
  %%     (\fn\bind{x}e_1) \; e_2 &\step& \sub{e_2/x} e_1\\
  %%     \pi_i \; (v_1, v_2) &\step& v_i\\
  %%     \rawcase{\ms{in}_i\,v}{\widevec{\ms{in_j}\,x_j \cto e_j}}
  %%     &\step& \sub{v/x_i} e_i\\
  %%     \ifthen{\ms{true}}{e_1}{e_2} &\step& e_1\\
  %%     \ifthen{\ms{false}}{e_1}{e_2} &\step& e_2

  %%     %% rules for unit
  %%     \vspace{1em}\\
  %%     \multicolumn{3}{c}{\textbf{Evaluating }\unit}\\
  %%     \unit_2 &\step& \ms{false}\\
  %%     \unit_{\Set{A}} &\step& \{\}\\
  %%     \unit_{L \x M} &\step& (\unit_L, \unit_M)\\
  %%     \unit_{A \to L} &\step& \fn\bind{x} \unit_L\\
  %%     \unit_{A \mto L} &\step& \fn\bind{x} \unit_L

  %%     %% rules for \vee
  %%     \vspace{1em}\\
  %%     \multicolumn{3}{c}{\textbf{Evaluating }\vee}\\
  %%     \ms{false} \vee_2 v &\step& v\\
  %%     \ms{true} \vee_2 v &\step& \ms{true}\\
  %%     %% the rule we've all been waiting for
  %%     \setlit{\vec{v}} \vee_{\Set{A}} \setlit{\vec{u}} &\step& \setlit{\vec{v}, \vec{u}}\\
  %%     (v_1, v_2) \vee_{L \x M} (u_1, u_2) &\step& (v_1 \vee_L u_1, v_2 \vee_M u_2)\\
  %%     v \vee_{A \to L} u &\step& \fn\bind{x} v\;x \vee_L u\;x\\
  %%     v \vee_{A \mto L} u &\step& \fn\bind{x} v\;x \vee_L u\;x

  %%   \end{array}
  %%   \begin{array}{ccl}

  %%     %% rules for \bigvee
  %%     %% \vspace{1em}\\
  %%     \multicolumn{3}{c}{\textbf{Evaluating }\bigvee}\\
  %%     \tforin{L}{x \in \{\}} e &\step& \unit_L\\
  %%     \tforin{L}{x \in \setlit{v, \vec{u}}} e
  %%     &\step& \sub{v/x} e \vee_L \tforin{L}{x \in \setlit{\vec{u}}} e

  %%     %% rules for \ms{fix}
  %%     \vspace{1em}\\
  %%     \multicolumn{3}{c}{\textbf{Evaluating \ms{fix} and \ms{iter}}}\\
  %%     \tfix{\fineq{L}}{x}{e} &\step& \iter{\fineq{L}}{\unit_{\fineq{L}}}{x}{e}\\
  %%     \iter{\eq{A}}{v}{x}{e} &\step& \iterstep{\eq{A}}{v}{\sub{v/x} e}{x}{e}\\
  %%     \iterstep{\eq{A}}{v_1}{v_2}{x}{e}
  %%     &\step& \begin{cases}
  %%       v_1 & \text{if}~{v_1 \aeq v_2 : \eq{A}}\\
  %%       \iter{\eq{A}}{v_2}{x}{e} & \text{otherwise}
  %%     \end{cases}\\
  %%     %% rules for fixle, iterle
  %%     \tfixle{\eq{L}}{x}{e_\top}{e} &\step& \iterle{\eq{L}}{e_\top}{\unit_{\eq{L}}}{x}{e}\\
  %%     \iterle{\eq{A}}{v_\top}{v}{x}{e}
  %%     &\step& \begin{cases}
  %%       \iterlestep{\eq{A}}{v_\top}{v}{\sub{v/x} e}{x}{e} & \text{if}~{v \le v_\top : \eq{A}}\\
  %%       v_\top & \text{otherwise}
  %%     \end{cases}\\
  %%     \iterlestep{\eq{A}}{v_\top}{v_1}{v_2}{x}{e}
  %%     &\step& \begin{cases}
  %%       v_1 &\text{if}~{v_1 \aeq v_2 : \eq{A}}\\
  %%       \iterle{\eq{A}}{v_\top}{v_2}{x}{e} & \text{otherwise}
  %%     \end{cases}
  %%   \end{array}
  %% \end{displaymath}
